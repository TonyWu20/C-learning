#include <stdio.h>
#include <stdlib.h>

#define PRIME 941

int hash(int val)
{
    return abs(val % PRIME);
}

struct hashNode
{
    int val;
    int index;
    struct hashNode *link;
    /* no need to deal with collision in this problem */
};
void lookup(struct hashNode *hashTab, int *nums, int numsSize, int target,
            int *res)
{
    for (int i = 0; i < numsSize; ++i)
    {
        int complement = target - nums[i];
        int hashVal = hash(complement);
        if (hashTab[hashVal].index == -1)
        {
            continue;
        }
        if (hashTab[hashVal].val == complement && hashTab[hashVal].index != i)
        {
            res[0] = i;
            res[1] = hashTab[hashVal].index;
            break;
        }
        if (hashTab[hashVal].val != complement)
        {
            struct hashNode *node;
            node = &hashTab[hashVal];
            while (node->link)
            {
                node = node->link;
                if (node->val == complement && node->index != i)
                {
                    res[0] = i;
                    res[1] = node->index;
                    break;
                }
            }
            continue;
        }
    }
}
int *twoSum(int *nums, int numsSize, int target, int *returnSize)
{
    struct hashNode hashTab[PRIME];
    for (int i = 0; i < PRIME; ++i)
    {
        hashTab[i].val = 0;
        hashTab[i].index = -1;
        hashTab[i].link = NULL;
    }
    for (int i = 0; i < numsSize; ++i)
    {
        int hashVal = hash(nums[i]);
        if (hashTab[hashVal].index == -1)
        {
            hashTab[hashVal].val = nums[i];
            hashTab[hashVal].index = i;
        }
        if (hashTab[hashVal].val != nums[i] && hashTab[hashVal].index != -1)
        {
            struct hashNode *node;
            node = &hashTab[hashVal];
            while (node->link)
            {
                node = node->link;
                if (node->val == nums[i])
                {
                    node->index = i;
                }
            }
            struct hashNode *new = malloc(sizeof(struct hashNode));
            new->index = i;
            new->val = nums[i];
            new->link = NULL;
            node->link = new;
        }
    }
    int *res = malloc(2 * sizeof(int));
    *returnSize = 2;
    lookup(hashTab, nums, numsSize, target, res);
    for (int i = 0; i < PRIME; ++i)
    {
        struct hashNode *node;
        node = hashTab[i].link;
        while (node != NULL)
        {
            struct hashNode *next;
            next = node->link;
            free(node);
            node = next;
        }
    }
    return res;
}

int main(int argc, char *argv[])
{
    /*int nums[] = {2, 7, 11, 15};*/
    /*int nums[] = {2, 1, 9, 4, 4, 56, 90, 3};*/
    /*int nums[] = {-1, -2, -3, -4, -5};*/
    int nums[] = {
        -2648199, -2191950, -7069790, -6106123, 6601048,  6546529,  5460262,
        8605503,  -6077410, -8417491, -8810000, 978480,   -9513232, 9941745,
        5854976,  8985131,  1134353,  3218644,  858477,   2236675,  8610795,
        -3503316, -5092251, -3881035, -6620634, 1418351,  5064120,  7872225,
        1799512,  -405889,  3710078,  -1177025, 2570663,  -1823780, -6065615,
        -2394514, 4565884,  6764895,  -37350,   3997370,  -6987504, 3440206,
        4337130,  -2712512, -7761757, -7331988, -5773961, -978299,  -3916167,
        7342928,  7185352,  -8066012, -6268865, -4796528, -4756039, -8019827,
        3840059,  -102730,  2839898,  6625629,  4124927,  -8766463, 7484577,
        -9889335, -5217151, -9820070, 6351702,  494271,   3887121,  5860510,
        -7591283, -9510238, -9034625, 2328577,  -9981403, -6915617, -3553356,
        820164,   -537872,  -6599260, -4595031, 2565085,  -2001043, 6546783,
        -962184,  -6306355, -3102827, -882388,  3265696,  7792237,  -7284151,
        -8613183, -488579,  -8359073, 6541130,  -4733026, -451845,  6326212,
        8142309,  4061018,  6991180,  5014565,  -4402607, -4670719, 7970744,
        -4786214, -3990057, 992363,   -9793572, -5294718, 8864369,  -3533340,
        -5938921, -5299992, 4863971,  3541799,  6118153,  -5575412, -5605694,
        1622665,  4484183,  9298842,  -6167905, -5129254, -9994786, -5251685,
        5016825,  -9387416, -2106353, 5661065,  4730593,  8387547,  5720915,
        6906950,  454820,   8016502,  1005860,  -3586494, -2763415, -9162255,
        -1923291, -1760733, -6004318, 9495296,  84377,    -9222153, 5034891,
        9976187,  8662991,  -1823715, 5897732,  -9626900, 8682356,  1738344,
        -8347611, 8040797,  -5807415, 9815434,  8321899,  -9112199, -567499,
        -2066538, 7625434,  -802848,  421711,   5312479,  -7572677, -1218211,
        4377506,  3445035,  -5168471, 7204648,  -6476140, 140319,   9155611,
        -9305202, -6306334, 7505265,  4865597,  -9796926, 2461602,  -7400706,
        -9778237, -9042684, 2350470,  -8385559, 3590124,  -8970902, -2848975,
        -3806819, 6007913,  9238307,  -2685539, -4045901, 294766,   346714,
        7898237,  -4210426, -5931572, -9536555, 1278767,  70805,    5269188,
        -1573414, 3094111,  2840389,  6326366,  -9156036, 6813930,  1028707,
        1058779,  4005821,  1746588,  -6334942, -251767,  7349801,  647022,
        5687532,  -4178304, 7054390,  -6170594, 9616856,  8794629,  5845984,
        1927064,  -7710787, -9773310, 9739980,  4884409,  2120624,  9603982,
        -8787508, 7939435,  -5982180, -3049725, 1969586,  4880318,  3722334,
        5428138,  -1289659, 8768018,  8287106,  -780036,  7862926,  -8439480,
        -4826487, 6752773,  221127,   -515321,  -3681476, -2960835, -9566097,
        177951,   -639695,  -2385883, 2976280,  -4971934, -5533995, 2605974,
        2839644,  -7370083, -4968356, -2283612, -3553469, -8099541, -1537202,
        8698376,  -9731173, -9121764, 3937832,  9642791,  5795128,  1665969,
        -9440647, -731277,  6287879,  -5571599, -8152951, 1928252,  -2065622,
        -5371987, 2015995,  7924061,  -2350179, -9429404, -1001567, 2741073,
        5172262,  -9121032, -9481408, 7067377,  9783847,  6295928,  -3989475,
        354380,   -5346836, -2108642, -5618382, 1389191,  -580054,  4490883,
        4504404,  -5576092, 8753979,  7130977,  -1549703, 3023139,  -6057479,
        -9568753, 2704935,  5053936,  -1713519, -2072791, 2706182,  -5462389,
        4522579,  -3186413, 8451805,  -1547348, -8104888, -1298414, -4071266,
        -900647,  -3214958, 1140493,  -2395524, -5729107, 8743042,  4086812,
        -9511625, 3690897,  -7942134, -5489473, -3335258, 2753172,  -1248513,
        -3580344, 5975466,  8113139,  6515433,  3973236,  940226,   490838,
        -7594925, 6854086,  -2367062, 4956969,  2907328,  -1407702, -9550548,
        8667295,  5190794,  -4882651, 9337226,  -2179450, 6278167,  4234200,
        4675920,  6854920,  5548567,  3225355,  224475,   -3181818, 1144165,
        982097,   3947133,  -142789,  -2048958, -9436121, -6178117, -8089867,
        -7457499, 5101198,  1819157,  -4793870, -4968342, 330556,   9446600,
        5665703,  675675,   2776512,  -5269133, 3213751,  8770725,  -3030647,
        -5899827, 2202507,  2152357,  -1267413, 8168262,  3099125,  -9733010,
        -6476231, 9051035,  -519246,  -6408245, -2204138, 5612693,  -2730967,
        -4705110, -7204292, 7074832,  5865450,  2426645,  4794059,  1886297,
        -4402515, 6465597,  3995380,  -8594056, 8404955,  884698,   7483641,
        -5185423, -138913,  -1474707, 1387014,  -726937,  6196197,  -8353634,
        -6838415, -3523338, -1408267, -6540468, 3309765,  8146190,  7635275,
        1930985,  -4535238, -2540383, -322781,  1074352,  1851759,  -3817922,
        4539177,  -8425485, 184757,   -9284624, -155667,  -1970625, -4404189,
        -853673,  -3288268, -3386114, -8880893, 1360753,  -2105172, 4616534,
        -8695309, -9540346, -9765950, -2676064, -7337220, -8049498, 4358222,
        4612869,  -5908969, 1133972,  3988666,  5782329,  931688,   -6345974,
        932897,   -3529663, 851910,   1676226,  -3824529, 1136688,  -7049051,
        -70772,   -3338643, -3668859, -5424221, 9884183,  -4233733, 5909387,
        6883835,  -3909344, -6689025, -2511903, 8047821,  -7857425, -8180975,
        -1123416, -5602382, 2807168,  5461471,  -7990740, 6031997,  4985186,
        8338416,  893313,   -4166003, -2787522, -185557,  807922,   -1609901,
        6628140,  -2388305, 7872114,  2916630,  -4791659, -4718279, 7518808,
        5828798,  7329529,  -1869900, -7883305, -7465205, -3223251, 2484274,
        -9511305, 8533742,  -194362,  1054590,  6816265,  -8372460, -7971200,
        644839,   -7895089, -3465323, -9012123, 1786031,  1383890,  2922377,
        2825445,  5975307,  7698714,  8261493,  -4032986, -2548734, 6155245,
        4997772,  3347659,  7131827,  -603506,  9220671,  9558790,  8132429,
        3934640,  1936522,  -434658,  -7899516, 1153176,  -7582837, -4528413,
        -9783308, -7923118, -8450810, -9093810, -1469505, 7344249,  -5202518,
        5816807,  -266025,  -9090320, -7800491, -7529655, 8932600,  7767306,
        -469443,  -8484741, -6167311, 9616461,  8106152,  747483,   -4237586,
        -1393925, -8933836, 7267554,  -7625642, -980412,  -126226,  -7630261,
        -4725343, -7406903, -4362196, 8165128,  -605204,  -8248814, -6636662,
        9890834,  -7831998, -4147984, -4765886, 4747300,  -3492161, -9938954,
        -818407,  -5569279, 7036408,  1717930,  -5033595, -924253,  -1450749,
        1866720,  49316,    4408738,  7723060,  -1738006, -7921101, 5058916,
        -4919126, 819813,   -2339684, 8967452,  9776768,  -5031421, -9995929,
        815561,   9243742,  -4201315, -6357366, 5704023,  4975152,  -6554259,
        -6423465, -7419649, 8750080,  -6039376, 9727813,  -4807463, 4206563,
        6407266,  -6757765, -8136696, -7112798, 2727207,  -4523000, 2582574,
        -3066192, -9497806, -2343938, -4247986, -3476157, 8614592,  -2385115,
        9076829,  9288096,  -9903888, -2423345, -9358781, -9853439, -1688122,
        -5578107, 1264112,  558625,   1849131,  7237866,  4756204,  369195,
        4571647,  -9859762, -7444919, -3688718, -3209240, -3560213, 4092321,
        5364283,  1882156,  -1657459, -9874186, -1693877, -8610902, 5136839,
        -8223908, -2330262, 6635395,  -7269524, 7334827,  5882934,  3038120,
        5818178,  -5156346, 8878356,  7979269,  7103363,  -1742165, -11192,
        3209976,  -586155,  -8831887, 6109656,  2447422,  2625765,  -4265098,
        6867355,  -5586037, 8454985,  -6879968, 2712785,  3556894,  4388165,
        -3718940, 8182466,  7622,     2544422,  4462137,  3089572,  2206929,
        5010673,  -5288164, -9669280, -78125,   8777496,  5656469,  5564228,
        2880122,  2873092,  -7854172, -2250858, -5155541, 5736451,  7824892,
        4608842,  6846033,  7367805,  2129922,  -2410311, 8241049,  7240992,
        9510038,  -9864389, 8154888,  2388153,  -9936743, 1381100,  999528,
        8468282,  -8461653, -4900873, 5739857,  -4386644, -2607603, -3085867,
        127309,   1211734,  8688293,  -9100195, -34442,   -5995774, -6232529,
        -4904717, 2021537,  207682,   -1612670, -1973491, 5943286,  -280876,
        -3450508, -5995612, -2894696, -8494659, 7393254,  920170,   2172025,
        -123149,  7863265,  5245073,  1870304,  2125808,  8791998,  -8925190,
        5968504,  3219301,  3419095,  -8877373, 1677107,  3325156,  1362377,
        -7943390, -5641786, 59409,    5703893,  -6861208, 5555768,  7968081,
        6704456,  7890086,  -9231558, -8176209, 9401591,  4533224,  6458398,
        6749980,  -2816008, 4249530,  6556814,  972440,   61032,    -3578747,
        -8853364, 5266499,  -265541,  -7454720, 4157452,  5843256,  -9949233,
        6765934,  -2280850, 5974378,  -4411384, -5106752, 7202591,  -8562826,
        -3877696, 7068903,  -2441877, -2115182, -6183370, -9753379, -5898292,
        -575546,  -8820128, -8802178, -4258456, 4919044,  -5798994, 9199992,
        -7981572, 823769,   -3883012, -2434056, 1513350,  -5221101, 9479517,
        2839062,  -1575444, 838221,   -9657485, -4072743, 378289,   -6680717,
        1093820,  -6642642, -2676855, 7337422,  -7241353, 1240091,  -2670827,
        3832644,  4733244,  3268930,  4637673,  -6488235, -1964720, 9044786,
        8902789,  -3832922, -308881,  6136160,  -9237383, 8607578,  -2723040,
        -1005210, -6251817, 8759042,  -3926050, 9943798,  -5100503, 2293715,
        2693996,  -4533177, -1496875, 1058911,  2248437,  6829156,  -9724050,
        1508290,  -253139,  -9025189, 7564299,  1545522,  5671038,  5542476,
        6500222,  -5001398, 9561601,  -3759288, 7378898,  -1626679, 6981256,
        -9166538, 3773764,  6342073,  -1786811, 5381338,  -4562925, -7720178,
        1351147,  -5407680, -1041596, -5165667, -8808110, 2395897,  2480653,
        1732097,  -9520625, -93296,   -8480069, -2284655, -5714346, 2647159,
        6580689,  -3193279, -6233499, -7725848, -472366,  1613319,  3484699,
        1490334,  4715102,  2046535,  -8381673, 6268143,  5991559,  -2658710,
        2559742,  5403212,  -9522382, 7971581,  -7481219, -3566807, -3684130,
        -4236886, -3234492, 2701447,  4222206,  4560455,  -8963769, -9928570,
        1098632,  8196737,  9547078,  -5920171, -8518966, 8789746,  1953718,
        5001255,  2385545,  -2880875, -3955938, -1946617, -4282678, 4242709,
        6966215,  2908990,  -5506302, -4181972, -2782083, -3629493, -2423152,
        143681,   -523805,  -1254792, -1939294, 5198033,  4652396,  -5957813,
        7700234,  -6127063, -124394,  171178,   -9491653, -3522247, 1684661,
        6806515,  988715,   7170056,  -2460082, 7086790,  -4458198};
    int target = -4840149;
    int *returnSize = malloc(sizeof(int));
    int *res;
    res = twoSum(nums, sizeof(nums) / sizeof(int), target, returnSize);
    printf("[%d,%d]\n", res[0], res[1]);
    free(res);
    free(returnSize);
    return 0;
}
